Interaction of `one` with `coerce` for slice puts, complicated but needs to feel be common-sense.

>>> import sys
>>> from fst import *

>>> _FILE_CACHE = {}  # {'fnm': list[str], ...}

>>> def version_ok_else_print(version: int, start_marker: str, stop_marker: str) -> bool:
...     """If python version high enough then do nothing, otherwise print what would have been printed."""
...
...     if sys.version_info[1] >= version:
...         return True
...
...     if (lines := _FILE_CACHE.get(__file__)) is None:
...         with open(__file__) as fp:
...             lines = _FILE_CACHE[__file__] = fp.readlines()
...
...     start_marker += '\n'
...     stop_marker += '\n'
...     itr = iter(enumerate(lines))
...
...     for start, line in itr:
...         if line.endswith(start_marker):
...             break
...     else:
...         raise RuntimeError(f'start marker {start_marker[:-1]} not found')
...
...     for stop, line in itr:
...         if line.endswith(stop_marker):
...             break
...     else:
...         raise RuntimeError(f'stop marker {stop_marker[:-1]} not found')
...
...     print(''.join(lines[start + 1 : stop])[:-1], end='')
...
...     return False

>>> def test_one_coerce_target_src(one: bool, coerce: bool, target: str, field: str, src: str, mode=None):
...     for name, code in [
...         ('src', src),
...         ('FST', FST(src, mode)),
...         ('AST', FST(src, mode).a),
...     ]:
...         try:
...             text = f"{name}: {FST(target).put_slice(code, field, one=one, coerce=coerce).verify().src}"
...         except Exception as exc:
...             text = f'{name}: {exc!r}'
...
...         print(text if name != 'src' else f'{text}  # {src=}')

>>> def test_target_srcs(target: str, field: str, srcs: list[str], mode=None):
...     for i, (one, coerce) in enumerate(((False, True), (False, False), (True, True), (True, False))):
...         print('\xa0')
...         print(text := f'{one=}, {coerce=}  ({mode=})')
...         print('-' * len(text))
...         print('\xa0')
...
...         last_src = srcs[-1]
...
...         for src in srcs:
...             test_one_coerce_target_src(one, coerce, target, field, src, mode)
...
...             if src is not last_src:
...                 print('\xa0')
...
...         if i < 3:
...             print('\xa0')




========================================================================================================================
_arglikes
========================================================================================================================

........................................................................................................................
>>> test_target_srcs('for _ in _ if a', 'ifs', ['x', '*x', 'x,', '*x,', '(x,)', '[x]', '{x}', '{x: y}'])
 
one=False, coerce=True  (mode=None)
-----------------------------------
 
src: for _ in _ if x  # src='x'
FST: for _ in _ if x
AST: for _ in _ if x
 
src: ParseError('expecting _comprehension_ifs, could not parse or coerce')  # src='*x'
FST: NodeError('expecting _comprehension_ifs, got Starred, could not coerce')
AST: NodeError('expecting _comprehension_ifs, got Starred, could not coerce')
 
src: for _ in _ if (x,)  # src='x,'
FST: for _ in _ if x
AST: for _ in _ if x
 
src: for _ in _ if (*x,)  # src='*x,'
FST: NodeError('expecting _comprehension_ifs, got Tuple, could not coerce')
AST: NodeError('expecting _comprehension_ifs, got Tuple, could not coerce')
 
src: for _ in _ if (x,)  # src='(x,)'
FST: for _ in _ if x
AST: for _ in _ if x
 
src: for _ in _ if [x]  # src='[x]'
FST: for _ in _ if x
AST: for _ in _ if x
 
src: for _ in _ if {x}  # src='{x}'
FST: for _ in _ if x
AST: for _ in _ if x
 
src: for _ in _ if {x: y}  # src='{x: y}'
FST: for _ in _ if {x: y}
AST: for _ in _ if {x: y}
 
 
one=False, coerce=False  (mode=None)
------------------------------------
 
src: SyntaxError('invalid syntax', ('<fst>', 2, 1, 'x\n', 2, 2))  # src='x'
FST: NodeError('expecting _comprehension_ifs, got Name, coerce disabled')
AST: NodeError('expecting _comprehension_ifs, got Name, coerce disabled')
 
src: ParseError("expecting comprehension ifs, does not start with 'if'")  # src='*x'
FST: NodeError('expecting _comprehension_ifs, got Starred, coerce disabled')
AST: NodeError('expecting _comprehension_ifs, got Starred, coerce disabled')
 
src: SyntaxError('invalid syntax', ('<fst>', 2, 1, 'x,\n', 2, 2))  # src='x,'
FST: NodeError('expecting _comprehension_ifs, got Tuple, coerce disabled')
AST: NodeError('expecting _comprehension_ifs, got Tuple, coerce disabled')
 
src: SyntaxError('invalid syntax', ('<fst>', 2, 3, '*x,\n', 2, 4))  # src='*x,'
FST: NodeError('expecting _comprehension_ifs, got Tuple, coerce disabled')
AST: NodeError('expecting _comprehension_ifs, got Tuple, coerce disabled')
 
src: ParseError("expecting comprehension ifs, does not start with 'if'")  # src='(x,)'
FST: NodeError('expecting _comprehension_ifs, got Tuple, coerce disabled')
AST: NodeError('expecting _comprehension_ifs, got Tuple, coerce disabled')
 
src: ParseError("expecting comprehension ifs, does not start with 'if'")  # src='[x]'
FST: NodeError('expecting _comprehension_ifs, got List, coerce disabled')
AST: NodeError('expecting _comprehension_ifs, got List, coerce disabled')
 
src: SyntaxError('invalid syntax', ('<fst>', 2, 1, '{x}\n', 2, 2))  # src='{x}'
FST: NodeError('expecting _comprehension_ifs, got Set, coerce disabled')
AST: NodeError('expecting _comprehension_ifs, got Set, coerce disabled')
 
src: SyntaxError('invalid syntax', ('<fst>', 2, 1, '{x: y}\n', 2, 2))  # src='{x: y}'
FST: NodeError('expecting _comprehension_ifs, got Dict, coerce disabled')
AST: NodeError('expecting _comprehension_ifs, got Dict, coerce disabled')
 
 
one=True, coerce=True  (mode=None)
----------------------------------
 
src: for _ in _ if x  # src='x'
FST: for _ in _ if x
AST: for _ in _ if x
 
src: ParseError('expecting _comprehension_ifs, could not parse or coerce')  # src='*x'
FST: NodeError('expecting _comprehension_ifs, got Starred, could not coerce')
AST: NodeError('expecting _comprehension_ifs, got Starred, could not coerce')
 
src: for _ in _ if (x,)  # src='x,'
FST: for _ in _ if x
AST: for _ in _ if x
 
src: for _ in _ if (*x,)  # src='*x,'
FST: NodeError('expecting _comprehension_ifs, got Tuple, could not coerce')
AST: NodeError('expecting _comprehension_ifs, got Tuple, could not coerce')
 
src: for _ in _ if (x,)  # src='(x,)'
FST: for _ in _ if x
AST: for _ in _ if x
 
src: for _ in _ if [x]  # src='[x]'
FST: for _ in _ if x
AST: for _ in _ if x
 
src: for _ in _ if {x}  # src='{x}'
FST: for _ in _ if x
AST: for _ in _ if x
 
src: for _ in _ if {x: y}  # src='{x: y}'
FST: for _ in _ if {x: y}
AST: for _ in _ if {x: y}
 
 
one=True, coerce=False  (mode=None)
-----------------------------------
 
src: SyntaxError('invalid syntax', ('<fst>', 2, 1, 'x\n', 2, 2))  # src='x'
FST: NodeError('expecting _comprehension_ifs, got Name, coerce disabled')
AST: NodeError('expecting _comprehension_ifs, got Name, coerce disabled')
 
src: ParseError("expecting comprehension ifs, does not start with 'if'")  # src='*x'
FST: NodeError('expecting _comprehension_ifs, got Starred, coerce disabled')
AST: NodeError('expecting _comprehension_ifs, got Starred, coerce disabled')
 
src: SyntaxError('invalid syntax', ('<fst>', 2, 1, 'x,\n', 2, 2))  # src='x,'
FST: NodeError('expecting _comprehension_ifs, got Tuple, coerce disabled')
AST: NodeError('expecting _comprehension_ifs, got Tuple, coerce disabled')
 
src: SyntaxError('invalid syntax', ('<fst>', 2, 3, '*x,\n', 2, 4))  # src='*x,'
FST: NodeError('expecting _comprehension_ifs, got Tuple, coerce disabled')
AST: NodeError('expecting _comprehension_ifs, got Tuple, coerce disabled')
 
src: ParseError("expecting comprehension ifs, does not start with 'if'")  # src='(x,)'
FST: NodeError('expecting _comprehension_ifs, got Tuple, coerce disabled')
AST: NodeError('expecting _comprehension_ifs, got Tuple, coerce disabled')
 
src: ParseError("expecting comprehension ifs, does not start with 'if'")  # src='[x]'
FST: NodeError('expecting _comprehension_ifs, got List, coerce disabled')
AST: NodeError('expecting _comprehension_ifs, got List, coerce disabled')
 
src: SyntaxError('invalid syntax', ('<fst>', 2, 1, '{x}\n', 2, 2))  # src='{x}'
FST: NodeError('expecting _comprehension_ifs, got Set, coerce disabled')
AST: NodeError('expecting _comprehension_ifs, got Set, coerce disabled')
 
src: SyntaxError('invalid syntax', ('<fst>', 2, 1, '{x: y}\n', 2, 2))  # src='{x: y}'
FST: NodeError('expecting _comprehension_ifs, got Dict, coerce disabled')
AST: NodeError('expecting _comprehension_ifs, got Dict, coerce disabled')


........................................................................................................................
>>> test_target_srcs('for _ in _ if a', 'ifs', ['if x', 'if x if y'], '_comprehension_ifs')
 
one=False, coerce=True  (mode='_comprehension_ifs')
---------------------------------------------------
 
src: for _ in _ if x  # src='if x'
FST: for _ in _ if x
AST: for _ in _ if x
 
src: for _ in _ if x if y  # src='if x if y'
FST: for _ in _ if x if y
AST: for _ in _ if x if y
 
 
one=False, coerce=False  (mode='_comprehension_ifs')
----------------------------------------------------
 
src: for _ in _ if x  # src='if x'
FST: for _ in _ if x
AST: for _ in _ if x
 
src: for _ in _ if x if y  # src='if x if y'
FST: for _ in _ if x if y
AST: for _ in _ if x if y
 
 
one=True, coerce=True  (mode='_comprehension_ifs')
--------------------------------------------------
 
src: for _ in _ if x  # src='if x'
FST: for _ in _ if x
AST: for _ in _ if x
 
src: NodeError("can only put single element as as 'one=True' to _comprehension_ifs")  # src='if x if y'
FST: NodeError("can only put single element as as 'one=True' to _comprehension_ifs")
AST: NodeError("can only put single element as as 'one=True' to _comprehension_ifs")
 
 
one=True, coerce=False  (mode='_comprehension_ifs')
---------------------------------------------------
 
src: for _ in _ if x  # src='if x'
FST: ValueError("cannot put _comprehension_ifs node as 'one=True' without 'coerce=True'")
AST: ValueError("cannot put _comprehension_ifs node as 'one=True' without 'coerce=True'")
 
src: NodeError("can only put single element as as 'one=True' to _comprehension_ifs")  # src='if x if y'
FST: ValueError("cannot put _comprehension_ifs node as 'one=True' without 'coerce=True'")
AST: ValueError("cannot put _comprehension_ifs node as 'one=True' without 'coerce=True'")




========================================================================================================================
_arglikes
========================================================================================================================

........................................................................................................................
>>> test_target_srcs('call(a, b, c)', '_args', ['x', '*x', 'x,', '*x,', '(x,)', '[x]', '{x}', '{x: y}',])
 
one=False, coerce=True  (mode=None)
-----------------------------------
 
src: call(x)  # src='x'
FST: call(x)
AST: call(x)
 
src: call(*x)  # src='*x'
FST: call(*x)
AST: call(*x)
 
src: call(x)  # src='x,'
FST: call(x)
AST: call(x)
 
src: call(*x)  # src='*x,'
FST: call(*x)
AST: call(*x)
 
src: call((x,))  # src='(x,)'
FST: call(x)
AST: call(x)
 
src: call([x])  # src='[x]'
FST: call(x)
AST: call(x)
 
src: call({x})  # src='{x}'
FST: call(x)
AST: call(x)
 
src: call({x: y})  # src='{x: y}'
FST: call({x: y})
AST: call({x: y})
 
 
one=False, coerce=False  (mode=None)
------------------------------------
 
src: call(x)  # src='x'
FST: NodeError('expecting _arglikes, got Name, coerce disabled')
AST: NodeError('expecting _arglikes, got Name, coerce disabled')
 
src: call(*x)  # src='*x'
FST: NodeError('expecting _arglikes, got Starred, coerce disabled')
AST: NodeError('expecting _arglikes, got Starred, coerce disabled')
 
src: call(x)  # src='x,'
FST: NodeError('expecting _arglikes, got Tuple, coerce disabled')
AST: NodeError('expecting _arglikes, got Tuple, coerce disabled')
 
src: call(*x)  # src='*x,'
FST: NodeError('expecting _arglikes, got Tuple, coerce disabled')
AST: NodeError('expecting _arglikes, got Tuple, coerce disabled')
 
src: call((x,))  # src='(x,)'
FST: NodeError('expecting _arglikes, got Tuple, coerce disabled')
AST: NodeError('expecting _arglikes, got Tuple, coerce disabled')
 
src: call([x])  # src='[x]'
FST: NodeError('expecting _arglikes, got List, coerce disabled')
AST: NodeError('expecting _arglikes, got List, coerce disabled')
 
src: call({x})  # src='{x}'
FST: NodeError('expecting _arglikes, got Set, coerce disabled')
AST: NodeError('expecting _arglikes, got Set, coerce disabled')
 
src: call({x: y})  # src='{x: y}'
FST: NodeError('expecting _arglikes, got Dict, coerce disabled')
AST: NodeError('expecting _arglikes, got Dict, coerce disabled')
 
 
one=True, coerce=True  (mode=None)
----------------------------------
 
src: call(x)  # src='x'
FST: call(x)
AST: call(x)
 
src: call(*x)  # src='*x'
FST: call(*x)
AST: call(*x)
 
src: call((x,))  # src='x,'
FST: call((x,))
AST: call((x,))
 
src: call((*x,))  # src='*x,'
FST: call((*x,))
AST: call((*x,))
 
src: call((x,))  # src='(x,)'
FST: call((x,))
AST: call((x,))
 
src: call([x])  # src='[x]'
FST: call([x])
AST: call([x])
 
src: call({x})  # src='{x}'
FST: call({x})
AST: call({x})
 
src: call({x: y})  # src='{x: y}'
FST: call({x: y})
AST: call({x: y})
 
 
one=True, coerce=False  (mode=None)
-----------------------------------
 
src: call(x)  # src='x'
FST: NodeError('expecting _arglikes, got Name, coerce disabled')
AST: NodeError('expecting _arglikes, got Name, coerce disabled')
 
src: call(*x)  # src='*x'
FST: NodeError('expecting _arglikes, got Starred, coerce disabled')
AST: NodeError('expecting _arglikes, got Starred, coerce disabled')
 
src: call((x,))  # src='x,'
FST: NodeError('expecting _arglikes, got Tuple, coerce disabled')
AST: NodeError('expecting _arglikes, got Tuple, coerce disabled')
 
src: call((*x,))  # src='*x,'
FST: NodeError('expecting _arglikes, got Tuple, coerce disabled')
AST: NodeError('expecting _arglikes, got Tuple, coerce disabled')
 
src: call((x,))  # src='(x,)'
FST: NodeError('expecting _arglikes, got Tuple, coerce disabled')
AST: NodeError('expecting _arglikes, got Tuple, coerce disabled')
 
src: call([x])  # src='[x]'
FST: NodeError('expecting _arglikes, got List, coerce disabled')
AST: NodeError('expecting _arglikes, got List, coerce disabled')
 
src: call({x})  # src='{x}'
FST: NodeError('expecting _arglikes, got Set, coerce disabled')
AST: NodeError('expecting _arglikes, got Set, coerce disabled')
 
src: call({x: y})  # src='{x: y}'
FST: NodeError('expecting _arglikes, got Dict, coerce disabled')
AST: NodeError('expecting _arglikes, got Dict, coerce disabled')


........................................................................................................................
>>> test_target_srcs('call(a, b, c)', '_args', ['x', '*x', 'k=w', '**kw'], '_arglikes')
 
one=False, coerce=True  (mode='_arglikes')
------------------------------------------
 
src: call(x)  # src='x'
FST: call(x)
AST: call(x)
 
src: call(*x)  # src='*x'
FST: call(*x)
AST: call(*x)
 
src: call(k=w)  # src='k=w'
FST: call(k=w)
AST: call(k=w)
 
src: call(**kw)  # src='**kw'
FST: call(**kw)
AST: call(**kw)
 
 
one=False, coerce=False  (mode='_arglikes')
-------------------------------------------
 
src: call(x)  # src='x'
FST: call(x)
AST: call(x)
 
src: call(*x)  # src='*x'
FST: call(*x)
AST: call(*x)
 
src: call(k=w)  # src='k=w'
FST: call(k=w)
AST: call(k=w)
 
src: call(**kw)  # src='**kw'
FST: call(**kw)
AST: call(**kw)
 
 
one=True, coerce=True  (mode='_arglikes')
-----------------------------------------
 
src: call(x)  # src='x'
FST: call((x,))
AST: call((x,))
 
src: call(*x)  # src='*x'
FST: call((*x,))
AST: call((*x,))
 
src: call(k=w)  # src='k=w'
FST: NodeError('keyword cannot be put into a Tuple for put as `one=True`')
AST: NodeError('keyword cannot be put into a Tuple for put as `one=True`')
 
src: call(**kw)  # src='**kw'
FST: NodeError('keyword cannot be put into a Tuple for put as `one=True`')
AST: NodeError('keyword cannot be put into a Tuple for put as `one=True`')
 
 
one=True, coerce=False  (mode='_arglikes')
------------------------------------------
 
src: call(x)  # src='x'
FST: call((x,))
AST: call((x,))
 
src: call(*x)  # src='*x'
FST: call((*x,))
AST: call((*x,))
 
src: call(k=w)  # src='k=w'
FST: NodeError('keyword cannot be put into a Tuple for put as `one=True`')
AST: NodeError('keyword cannot be put into a Tuple for put as `one=True`')
 
src: call(**kw)  # src='**kw'
FST: NodeError('keyword cannot be put into a Tuple for put as `one=True`')
AST: NodeError('keyword cannot be put into a Tuple for put as `one=True`')


........................................................................................................................
>>> test_target_srcs('call(a, b, c)', '_args', ['k=w', '**kw'], 'keyword')
 
one=False, coerce=True  (mode='keyword')
----------------------------------------
 
src: call(k=w)  # src='k=w'
FST: call(k=w)
AST: call(k=w)
 
src: call(**kw)  # src='**kw'
FST: call(**kw)
AST: call(**kw)
 
 
one=False, coerce=False  (mode='keyword')
-----------------------------------------
 
src: call(k=w)  # src='k=w'
FST: NodeError('expecting _arglikes, got keyword, coerce disabled')
AST: NodeError('expecting _arglikes, got keyword, coerce disabled')
 
src: call(**kw)  # src='**kw'
FST: NodeError('expecting _arglikes, got keyword, coerce disabled')
AST: NodeError('expecting _arglikes, got keyword, coerce disabled')
 
 
one=True, coerce=True  (mode='keyword')
---------------------------------------
 
src: call(k=w)  # src='k=w'
FST: call(k=w)
AST: call(k=w)
 
src: call(**kw)  # src='**kw'
FST: call(**kw)
AST: call(**kw)
 
 
one=True, coerce=False  (mode='keyword')
----------------------------------------
 
src: call(k=w)  # src='k=w'
FST: NodeError('expecting _arglikes, got keyword, coerce disabled')
AST: NodeError('expecting _arglikes, got keyword, coerce disabled')
 
src: call(**kw)  # src='**kw'
FST: NodeError('expecting _arglikes, got keyword, coerce disabled')
AST: NodeError('expecting _arglikes, got keyword, coerce disabled')




========================================================================================================================
_comprehensions
========================================================================================================================

........................................................................................................................
>>> test_target_srcs('[a for a in a]', 'generators', ['for x in x', 'for x in x for y in y'], '_comprehensions')
 
one=False, coerce=True  (mode='_comprehensions')
------------------------------------------------
 
src: [a for x in x]  # src='for x in x'
FST: [a for x in x]
AST: [a for x in x]
 
src: [a for x in x for y in y]  # src='for x in x for y in y'
FST: [a for x in x for y in y]
AST: [a for x in x for y in y]
 
 
one=False, coerce=False  (mode='_comprehensions')
-------------------------------------------------
 
src: [a for x in x]  # src='for x in x'
FST: [a for x in x]
AST: [a for x in x]
 
src: [a for x in x for y in y]  # src='for x in x for y in y'
FST: [a for x in x for y in y]
AST: [a for x in x for y in y]
 
 
one=True, coerce=True  (mode='_comprehensions')
-----------------------------------------------
 
src: [a for x in x]  # src='for x in x'
FST: [a for x in x]
AST: [a for x in x]
 
src: NodeError("can only put single element as as 'one=True' to _comprehensions")  # src='for x in x for y in y'
FST: NodeError("can only put single element as as 'one=True' to _comprehensions")
AST: NodeError("can only put single element as as 'one=True' to _comprehensions")
 
 
one=True, coerce=False  (mode='_comprehensions')
------------------------------------------------
 
src: [a for x in x]  # src='for x in x'
FST: ValueError("cannot put _comprehensions node as 'one=True' without 'coerce=True'")
AST: ValueError("cannot put _comprehensions node as 'one=True' without 'coerce=True'")
 
src: NodeError("can only put single element as as 'one=True' to _comprehensions")  # src='for x in x for y in y'
FST: ValueError("cannot put _comprehensions node as 'one=True' without 'coerce=True'")
AST: ValueError("cannot put _comprehensions node as 'one=True' without 'coerce=True'")




========================================================================================================================
_aliases
========================================================================================================================

........................................................................................................................
>>> test_target_srcs('import a', 'names', ['x', 'x.y', 'x, y'])
 
one=False, coerce=True  (mode=None)
-----------------------------------
 
src: import x  # src='x'
FST: import x
AST: import x
 
src: import x.y  # src='x.y'
FST: import x.y
AST: import x.y
 
src: import x, y  # src='x, y'
FST: import x, y
AST: import x, y
 
 
one=False, coerce=False  (mode=None)
------------------------------------
 
src: import x  # src='x'
FST: NodeError('expecting _aliases, got Name, coerce disabled')
AST: NodeError('expecting _aliases, got Name, coerce disabled')
 
src: import x.y  # src='x.y'
FST: NodeError('expecting _aliases, got Attribute, coerce disabled')
AST: NodeError('expecting _aliases, got Attribute, coerce disabled')
 
src: import x, y  # src='x, y'
FST: NodeError('expecting _aliases, got Tuple, coerce disabled')
AST: NodeError('expecting _aliases, got Tuple, coerce disabled')
 
 
one=True, coerce=True  (mode=None)
----------------------------------
 
src: import x  # src='x'
FST: import x
AST: import x
 
src: import x.y  # src='x.y'
FST: import x.y
AST: import x.y
 
src: NodeError("can only put single element as as 'one=True' to _aliases")  # src='x, y'
FST: NodeError("can only put single element as as 'one=True' to _aliases")
AST: NodeError("can only put single element as as 'one=True' to _aliases")
 
 
one=True, coerce=False  (mode=None)
-----------------------------------
 
src: import x  # src='x'
FST: NodeError('expecting _aliases, got Name, coerce disabled')
AST: NodeError('expecting _aliases, got Name, coerce disabled')
 
src: import x.y  # src='x.y'
FST: NodeError('expecting _aliases, got Attribute, coerce disabled')
AST: NodeError('expecting _aliases, got Attribute, coerce disabled')
 
src: NodeError("can only put single element as as 'one=True' to _aliases")  # src='x, y'
FST: NodeError('expecting _aliases, got Tuple, coerce disabled')
AST: NodeError('expecting _aliases, got Tuple, coerce disabled')


........................................................................................................................
>>> test_target_srcs('import a', 'names', ['x', 'x.y', 'x, y'], '_aliases')
 
one=False, coerce=True  (mode='_aliases')
-----------------------------------------
 
src: import x  # src='x'
FST: import x
AST: import x
 
src: import x.y  # src='x.y'
FST: import x.y
AST: import x.y
 
src: import x, y  # src='x, y'
FST: import x, y
AST: import x, y
 
 
one=False, coerce=False  (mode='_aliases')
------------------------------------------
 
src: import x  # src='x'
FST: import x
AST: import x
 
src: import x.y  # src='x.y'
FST: import x.y
AST: import x.y
 
src: import x, y  # src='x, y'
FST: import x, y
AST: import x, y
 
 
one=True, coerce=True  (mode='_aliases')
----------------------------------------
 
src: import x  # src='x'
FST: import x
AST: import x
 
src: import x.y  # src='x.y'
FST: import x.y
AST: import x.y
 
src: NodeError("can only put single element as as 'one=True' to _aliases")  # src='x, y'
FST: NodeError("can only put single element as as 'one=True' to _aliases")
AST: NodeError("can only put single element as as 'one=True' to _aliases")
 
 
one=True, coerce=False  (mode='_aliases')
-----------------------------------------
 
src: import x  # src='x'
FST: ValueError("cannot put _aliases node as 'one=True' without 'coerce=True'")
AST: ValueError("cannot put _aliases node as 'one=True' without 'coerce=True'")
 
src: import x.y  # src='x.y'
FST: ValueError("cannot put _aliases node as 'one=True' without 'coerce=True'")
AST: ValueError("cannot put _aliases node as 'one=True' without 'coerce=True'")
 
src: NodeError("can only put single element as as 'one=True' to _aliases")  # src='x, y'
FST: ValueError("cannot put _aliases node as 'one=True' without 'coerce=True'")
AST: ValueError("cannot put _aliases node as 'one=True' without 'coerce=True'")




========================================================================================================================
_withitems
========================================================================================================================

........................................................................................................................
>>> test_target_srcs('with a: pass', 'items', ['x', '*x', 'x,', '*x,', '(x,)', '[x]', '{x}', '{x: y}'])
 
one=False, coerce=True  (mode=None)
-----------------------------------
 
src: with x: pass  # src='x'
FST: with x: pass
AST: with x: pass
 
src: SyntaxError('cannot use starred expression here', ('<fst>', 2, 1, '*x', 2, 3))  # src='*x'
FST: NodeError('expecting _withitems, got Starred, could not coerce')
AST: NodeError('expecting _withitems, got Starred, could not coerce')
 
src: with x: pass  # src='x,'
FST: with x: pass
AST: with x: pass
 
src: SyntaxError('invalid syntax')  # src='*x,'
FST: NodeError('expecting _withitems, got Tuple, could not coerce')
AST: NodeError('expecting _withitems, got Tuple, could not coerce')
 
src: with ((x,)): pass  # src='(x,)'
FST: with x: pass
AST: with x: pass
 
src: with [x]: pass  # src='[x]'
FST: with x: pass
AST: with x: pass
 
src: with {x}: pass  # src='{x}'
FST: with x: pass
AST: with x: pass
 
src: with {x: y}: pass  # src='{x: y}'
FST: with {x: y}: pass
AST: with {x: y}: pass
 
 
one=False, coerce=False  (mode=None)
------------------------------------
 
src: with x: pass  # src='x'
FST: NodeError('expecting _withitems, got Name, coerce disabled')
AST: NodeError('expecting _withitems, got Name, coerce disabled')
 
src: SyntaxError('cannot use starred expression here', ('<fst>', 2, 1, '*x', 2, 3))  # src='*x'
FST: NodeError('expecting _withitems, got Starred, coerce disabled')
AST: NodeError('expecting _withitems, got Starred, coerce disabled')
 
src: with x: pass  # src='x,'
FST: NodeError('expecting _withitems, got Tuple, coerce disabled')
AST: NodeError('expecting _withitems, got Tuple, coerce disabled')
 
src: SyntaxError('invalid syntax')  # src='*x,'
FST: NodeError('expecting _withitems, got Tuple, coerce disabled')
AST: NodeError('expecting _withitems, got Tuple, coerce disabled')
 
src: with ((x,)): pass  # src='(x,)'
FST: NodeError('expecting _withitems, got Tuple, coerce disabled')
AST: NodeError('expecting _withitems, got Tuple, coerce disabled')
 
src: with [x]: pass  # src='[x]'
FST: NodeError('expecting _withitems, got List, coerce disabled')
AST: NodeError('expecting _withitems, got List, coerce disabled')
 
src: with {x}: pass  # src='{x}'
FST: NodeError('expecting _withitems, got Set, coerce disabled')
AST: NodeError('expecting _withitems, got Set, coerce disabled')
 
src: with {x: y}: pass  # src='{x: y}'
FST: NodeError('expecting _withitems, got Dict, coerce disabled')
AST: NodeError('expecting _withitems, got Dict, coerce disabled')
 
 
one=True, coerce=True  (mode=None)
----------------------------------
 
src: with x: pass  # src='x'
FST: with x: pass
AST: with x: pass
 
src: SyntaxError('cannot use starred expression here', ('<fst>', 2, 1, '*x', 2, 3))  # src='*x'
FST: NodeError('expecting _withitems, got Starred, could not coerce')
AST: NodeError('expecting _withitems, got Starred, could not coerce')
 
src: with ((x,)): pass  # src='x,'
FST: with ((x,)): pass
AST: with ((x,)): pass
 
src: with ((*x,)): pass  # src='*x,'
FST: with ((*x,)): pass
AST: with ((*x,)): pass
 
src: with ((x,)): pass  # src='(x,)'
FST: with ((x,)): pass
AST: with ((x,)): pass
 
src: with [x]: pass  # src='[x]'
FST: with [x]: pass
AST: with [x]: pass
 
src: with {x}: pass  # src='{x}'
FST: with {x}: pass
AST: with {x}: pass
 
src: with {x: y}: pass  # src='{x: y}'
FST: with {x: y}: pass
AST: with {x: y}: pass
 
 
one=True, coerce=False  (mode=None)
-----------------------------------
 
src: with x: pass  # src='x'
FST: NodeError('expecting _withitems, got Name, coerce disabled')
AST: NodeError('expecting _withitems, got Name, coerce disabled')
 
src: SyntaxError('cannot use starred expression here', ('<fst>', 2, 1, '*x', 2, 3))  # src='*x'
FST: NodeError('expecting _withitems, got Starred, coerce disabled')
AST: NodeError('expecting _withitems, got Starred, coerce disabled')
 
src: with ((x,)): pass  # src='x,'
FST: NodeError('expecting _withitems, got Tuple, coerce disabled')
AST: NodeError('expecting _withitems, got Tuple, coerce disabled')
 
src: with ((*x,)): pass  # src='*x,'
FST: NodeError('expecting _withitems, got Tuple, coerce disabled')
AST: NodeError('expecting _withitems, got Tuple, coerce disabled')
 
src: with ((x,)): pass  # src='(x,)'
FST: NodeError('expecting _withitems, got Tuple, coerce disabled')
AST: NodeError('expecting _withitems, got Tuple, coerce disabled')
 
src: with [x]: pass  # src='[x]'
FST: NodeError('expecting _withitems, got List, coerce disabled')
AST: NodeError('expecting _withitems, got List, coerce disabled')
 
src: with {x}: pass  # src='{x}'
FST: NodeError('expecting _withitems, got Set, coerce disabled')
AST: NodeError('expecting _withitems, got Set, coerce disabled')
 
src: with {x: y}: pass  # src='{x: y}'
FST: NodeError('expecting _withitems, got Dict, coerce disabled')
AST: NodeError('expecting _withitems, got Dict, coerce disabled')


........................................................................................................................
>>> test_target_srcs('with a: pass', 'items', ['x as x'], 'withitem')
 
one=False, coerce=True  (mode='withitem')
-----------------------------------------
 
src: with x as x: pass  # src='x as x'
FST: with x as x: pass
AST: with x as x: pass
 
 
one=False, coerce=False  (mode='withitem')
------------------------------------------
 
src: with x as x: pass  # src='x as x'
FST: NodeError('expecting _withitems, got withitem, coerce disabled')
AST: NodeError('expecting _withitems, got withitem, coerce disabled')
 
 
one=True, coerce=True  (mode='withitem')
----------------------------------------
 
src: with x as x: pass  # src='x as x'
FST: with x as x: pass
AST: with x as x: pass
 
 
one=True, coerce=False  (mode='withitem')
-----------------------------------------
 
src: with x as x: pass  # src='x as x'
FST: NodeError('expecting _withitems, got withitem, coerce disabled')
AST: NodeError('expecting _withitems, got withitem, coerce disabled')


........................................................................................................................
>>> test_target_srcs('with a: pass', 'items', ['x as x', 'x as x,', 'x as x, y as y'], '_withitems')
 
one=False, coerce=True  (mode='_withitems')
-------------------------------------------
 
src: with x as x: pass  # src='x as x'
FST: with x as x: pass
AST: with x as x: pass
 
src: with x as x: pass  # src='x as x,'
FST: with x as x: pass
AST: with x as x: pass
 
src: with x as x, y as y: pass  # src='x as x, y as y'
FST: with x as x, y as y: pass
AST: with x as x, y as y: pass
 
 
one=False, coerce=False  (mode='_withitems')
--------------------------------------------
 
src: with x as x: pass  # src='x as x'
FST: with x as x: pass
AST: with x as x: pass
 
src: with x as x: pass  # src='x as x,'
FST: with x as x: pass
AST: with x as x: pass
 
src: with x as x, y as y: pass  # src='x as x, y as y'
FST: with x as x, y as y: pass
AST: with x as x, y as y: pass
 
 
one=True, coerce=True  (mode='_withitems')
------------------------------------------
 
src: with x as x: pass  # src='x as x'
FST: NodeError('withitem with optional_vars cannot be put into a Tuple for put as `one=True`')
AST: NodeError('withitem with optional_vars cannot be put into a Tuple for put as `one=True`')
 
src: NodeError('withitem with optional_vars cannot be put into a Tuple for put as `one=True`')  # src='x as x,'
FST: NodeError('withitem with optional_vars cannot be put into a Tuple for put as `one=True`')
AST: NodeError('withitem with optional_vars cannot be put into a Tuple for put as `one=True`')
 
src: NodeError('withitem with optional_vars cannot be put into a Tuple for put as `one=True`')  # src='x as x, y as y'
FST: NodeError('withitem with optional_vars cannot be put into a Tuple for put as `one=True`')
AST: NodeError('withitem with optional_vars cannot be put into a Tuple for put as `one=True`')
 
 
one=True, coerce=False  (mode='_withitems')
-------------------------------------------
 
src: with x as x: pass  # src='x as x'
FST: NodeError('withitem with optional_vars cannot be put into a Tuple for put as `one=True`')
AST: NodeError('withitem with optional_vars cannot be put into a Tuple for put as `one=True`')
 
src: NodeError('withitem with optional_vars cannot be put into a Tuple for put as `one=True`')  # src='x as x,'
FST: NodeError('withitem with optional_vars cannot be put into a Tuple for put as `one=True`')
AST: NodeError('withitem with optional_vars cannot be put into a Tuple for put as `one=True`')
 
src: NodeError('withitem with optional_vars cannot be put into a Tuple for put as `one=True`')  # src='x as x, y as y'
FST: NodeError('withitem with optional_vars cannot be put into a Tuple for put as `one=True`')
AST: NodeError('withitem with optional_vars cannot be put into a Tuple for put as `one=True`')




========================================================================================================================
_type_params
========================================================================================================================

........................................................................................................................
>>> if version_ok_else_print(12, 'TYPE_PARAMS_1_START', 'TYPE_PARAMS_1_STOP'):
...     test_target_srcs('type t[a, b, c] = ...', 'type_params', ['x', '*x', 'x,', '*x,', '(x,)', '[x]', '{x}', '{x: y}',])  # TYPE_PARAMS_1_START
 
one=False, coerce=True  (mode=None)
-----------------------------------
 
src: type t[x] = ...  # src='x'
FST: type t[x] = ...
AST: type t[x] = ...
 
src: type t[*x] = ...  # src='*x'
FST: type t[*x] = ...
AST: type t[*x] = ...
 
src: type t[x] = ...  # src='x,'
FST: type t[x] = ...
AST: type t[x] = ...
 
src: type t[*x] = ...  # src='*x,'
FST: type t[*x] = ...
AST: type t[*x] = ...
 
src: SyntaxError('invalid syntax', ('<fst>', 2, 1, '(x,)', 2, 2))  # src='(x,)'
FST: type t[x] = ...
AST: type t[x] = ...
 
src: SyntaxError('invalid syntax', ('<fst>', 2, 1, '[x]', 2, 2))  # src='[x]'
FST: type t[x] = ...
AST: type t[x] = ...
 
src: SyntaxError('invalid syntax', ('<fst>', 2, 1, '{x}', 2, 2))  # src='{x}'
FST: type t[x] = ...
AST: type t[x] = ...
 
src: SyntaxError('invalid syntax', ('<fst>', 2, 1, '{x: y}', 2, 2))  # src='{x: y}'
FST: NodeError('expecting _type_params, got Dict, could not coerce')
AST: NodeError('expecting _type_params, got Dict, could not coerce')
 
 
one=False, coerce=False  (mode=None)
------------------------------------
 
src: type t[x] = ...  # src='x'
FST: NodeError('expecting _type_params, got Name, coerce disabled')
AST: NodeError('expecting _type_params, got Name, coerce disabled')
 
src: type t[*x] = ...  # src='*x'
FST: NodeError('expecting _type_params, got Starred, coerce disabled')
AST: NodeError('expecting _type_params, got Starred, coerce disabled')
 
src: type t[x] = ...  # src='x,'
FST: NodeError('expecting _type_params, got Tuple, coerce disabled')
AST: NodeError('expecting _type_params, got Tuple, coerce disabled')
 
src: type t[*x] = ...  # src='*x,'
FST: NodeError('expecting _type_params, got Tuple, coerce disabled')
AST: NodeError('expecting _type_params, got Tuple, coerce disabled')
 
src: SyntaxError('invalid syntax', ('<fst>', 2, 1, '(x,)', 2, 2))  # src='(x,)'
FST: NodeError('expecting _type_params, got Tuple, coerce disabled')
AST: NodeError('expecting _type_params, got Tuple, coerce disabled')
 
src: SyntaxError('invalid syntax', ('<fst>', 2, 1, '[x]', 2, 2))  # src='[x]'
FST: NodeError('expecting _type_params, got List, coerce disabled')
AST: NodeError('expecting _type_params, got List, coerce disabled')
 
src: SyntaxError('invalid syntax', ('<fst>', 2, 1, '{x}', 2, 2))  # src='{x}'
FST: NodeError('expecting _type_params, got Set, coerce disabled')
AST: NodeError('expecting _type_params, got Set, coerce disabled')
 
src: SyntaxError('invalid syntax', ('<fst>', 2, 1, '{x: y}', 2, 2))  # src='{x: y}'
FST: NodeError('expecting _type_params, got Dict, coerce disabled')
AST: NodeError('expecting _type_params, got Dict, coerce disabled')
 
 
one=True, coerce=True  (mode=None)
----------------------------------
 
src: type t[x] = ...  # src='x'
FST: type t[x] = ...
AST: type t[x] = ...
 
src: type t[*x] = ...  # src='*x'
FST: type t[*x] = ...
AST: type t[*x] = ...
 
src: type t[x] = ...  # src='x,'
FST: type t[x] = ...
AST: type t[x] = ...
 
src: type t[*x] = ...  # src='*x,'
FST: type t[*x] = ...
AST: type t[*x] = ...
 
src: SyntaxError('invalid syntax', ('<fst>', 2, 1, '(x,)', 2, 2))  # src='(x,)'
FST: type t[x] = ...
AST: type t[x] = ...
 
src: SyntaxError('invalid syntax', ('<fst>', 2, 1, '[x]', 2, 2))  # src='[x]'
FST: type t[x] = ...
AST: type t[x] = ...
 
src: SyntaxError('invalid syntax', ('<fst>', 2, 1, '{x}', 2, 2))  # src='{x}'
FST: type t[x] = ...
AST: type t[x] = ...
 
src: SyntaxError('invalid syntax', ('<fst>', 2, 1, '{x: y}', 2, 2))  # src='{x: y}'
FST: NodeError('expecting _type_params, got Dict, could not coerce')
AST: NodeError('expecting _type_params, got Dict, could not coerce')
 
 
one=True, coerce=False  (mode=None)
-----------------------------------
 
src: type t[x] = ...  # src='x'
FST: NodeError('expecting _type_params, got Name, coerce disabled')
AST: NodeError('expecting _type_params, got Name, coerce disabled')
 
src: type t[*x] = ...  # src='*x'
FST: NodeError('expecting _type_params, got Starred, coerce disabled')
AST: NodeError('expecting _type_params, got Starred, coerce disabled')
 
src: type t[x] = ...  # src='x,'
FST: NodeError('expecting _type_params, got Tuple, coerce disabled')
AST: NodeError('expecting _type_params, got Tuple, coerce disabled')
 
src: type t[*x] = ...  # src='*x,'
FST: NodeError('expecting _type_params, got Tuple, coerce disabled')
AST: NodeError('expecting _type_params, got Tuple, coerce disabled')
 
src: SyntaxError('invalid syntax', ('<fst>', 2, 1, '(x,)', 2, 2))  # src='(x,)'
FST: NodeError('expecting _type_params, got Tuple, coerce disabled')
AST: NodeError('expecting _type_params, got Tuple, coerce disabled')
 
src: SyntaxError('invalid syntax', ('<fst>', 2, 1, '[x]', 2, 2))  # src='[x]'
FST: NodeError('expecting _type_params, got List, coerce disabled')
AST: NodeError('expecting _type_params, got List, coerce disabled')
 
src: SyntaxError('invalid syntax', ('<fst>', 2, 1, '{x}', 2, 2))  # src='{x}'
FST: NodeError('expecting _type_params, got Set, coerce disabled')
AST: NodeError('expecting _type_params, got Set, coerce disabled')
 
src: SyntaxError('invalid syntax', ('<fst>', 2, 1, '{x: y}', 2, 2))  # src='{x: y}'
FST: NodeError('expecting _type_params, got Dict, coerce disabled')
AST: NodeError('expecting _type_params, got Dict, coerce disabled')

# TYPE_PARAMS_1_STOP


........................................................................................................................
>>> if version_ok_else_print(12, 'TYPE_PARAMS_2_START', 'TYPE_PARAMS_2_STOP'):
...     test_target_srcs('type t[a, b, c] = ...', 'type_params', ['T', '*U', '**V'], 'type_param')  # TYPE_PARAMS_2_START
 
one=False, coerce=True  (mode='type_param')
-------------------------------------------
 
src: type t[T] = ...  # src='T'
FST: type t[T] = ...
AST: type t[T] = ...
 
src: type t[*U] = ...  # src='*U'
FST: type t[*U] = ...
AST: type t[*U] = ...
 
src: type t[**V] = ...  # src='**V'
FST: type t[**V] = ...
AST: type t[**V] = ...
 
 
one=False, coerce=False  (mode='type_param')
--------------------------------------------
 
src: type t[T] = ...  # src='T'
FST: NodeError('expecting _type_params, got TypeVar, coerce disabled')
AST: NodeError('expecting _type_params, got TypeVar, coerce disabled')
 
src: type t[*U] = ...  # src='*U'
FST: NodeError('expecting _type_params, got TypeVarTuple, coerce disabled')
AST: NodeError('expecting _type_params, got TypeVarTuple, coerce disabled')
 
src: type t[**V] = ...  # src='**V'
FST: NodeError('expecting _type_params, got ParamSpec, coerce disabled')
AST: NodeError('expecting _type_params, got ParamSpec, coerce disabled')
 
 
one=True, coerce=True  (mode='type_param')
------------------------------------------
 
src: type t[T] = ...  # src='T'
FST: type t[T] = ...
AST: type t[T] = ...
 
src: type t[*U] = ...  # src='*U'
FST: type t[*U] = ...
AST: type t[*U] = ...
 
src: type t[**V] = ...  # src='**V'
FST: type t[**V] = ...
AST: type t[**V] = ...
 
 
one=True, coerce=False  (mode='type_param')
-------------------------------------------
 
src: type t[T] = ...  # src='T'
FST: NodeError('expecting _type_params, got TypeVar, coerce disabled')
AST: NodeError('expecting _type_params, got TypeVar, coerce disabled')
 
src: type t[*U] = ...  # src='*U'
FST: NodeError('expecting _type_params, got TypeVarTuple, coerce disabled')
AST: NodeError('expecting _type_params, got TypeVarTuple, coerce disabled')
 
src: type t[**V] = ...  # src='**V'
FST: NodeError('expecting _type_params, got ParamSpec, coerce disabled')
AST: NodeError('expecting _type_params, got ParamSpec, coerce disabled')

# TYPE_PARAMS_2_STOP


========================================================================================================================
_expr_arglikes
========================================================================================================================

>>> test_target_srcs('call(a, b, c)', 'args', ['x', '*x', 'x,', '*x,', '(x,)', '[x]', '{x}', '{x: y}'])
 
one=False, coerce=True  (mode=None)
-----------------------------------
 
src: call(x)  # src='x'
FST: call(x)
AST: call(x)
 
src: call(*x)  # src='*x'
FST: call(*x)
AST: call(*x)
 
src: call(x)  # src='x,'
FST: call(x)
AST: call(x)
 
src: call(*x)  # src='*x,'
FST: call(*x)
AST: call(*x)
 
src: call((x,))  # src='(x,)'
FST: call(x)
AST: call(x)
 
src: call([x])  # src='[x]'
FST: call(x)
AST: call(x)
 
src: call({x})  # src='{x}'
FST: call(x)
AST: call(x)
 
src: call({x: y})  # src='{x: y}'
FST: call({x: y})
AST: call({x: y})
 
 
one=False, coerce=False  (mode=None)
------------------------------------
 
src: call(x)  # src='x'
FST: NodeError('expecting Tuple, got Name, coerce disabled')
AST: NodeError('expecting Tuple, got Name, coerce disabled')
 
src: call(*x)  # src='*x'
FST: NodeError('expecting Tuple, got Starred, coerce disabled')
AST: NodeError('expecting Tuple, got Starred, coerce disabled')
 
src: call(x)  # src='x,'
FST: call(x)
AST: call(x)
 
src: call(*x)  # src='*x,'
FST: call(*x)
AST: call(*x)
 
src: call((x,))  # src='(x,)'
FST: call(x)
AST: call(x)
 
src: call([x])  # src='[x]'
FST: NodeError('expecting Tuple, got List, coerce disabled')
AST: NodeError('expecting Tuple, got List, coerce disabled')
 
src: call({x})  # src='{x}'
FST: NodeError('expecting Tuple, got Set, coerce disabled')
AST: NodeError('expecting Tuple, got Set, coerce disabled')
 
src: call({x: y})  # src='{x: y}'
FST: NodeError('expecting Tuple, got Dict, coerce disabled')
AST: NodeError('expecting Tuple, got Dict, coerce disabled')
 
 
one=True, coerce=True  (mode=None)
----------------------------------
 
src: call(x)  # src='x'
FST: call(x)
AST: call(x)
 
src: call(*x)  # src='*x'
FST: call(*x)
AST: call(*x)
 
src: call((x,))  # src='x,'
FST: call((x,))
AST: call((x,))
 
src: call((*x,))  # src='*x,'
FST: call((*x,))
AST: call((*x,))
 
src: call((x,))  # src='(x,)'
FST: call((x,))
AST: call((x,))
 
src: call([x])  # src='[x]'
FST: call([x])
AST: call([x])
 
src: call({x})  # src='{x}'
FST: call({x})
AST: call({x})
 
src: call({x: y})  # src='{x: y}'
FST: call({x: y})
AST: call({x: y})
 
 
one=True, coerce=False  (mode=None)
-----------------------------------
 
src: call(x)  # src='x'
FST: NodeError('expecting Tuple, got Name, coerce disabled')
AST: NodeError('expecting Tuple, got Name, coerce disabled')
 
src: call(*x)  # src='*x'
FST: NodeError('expecting Tuple, got Starred, coerce disabled')
AST: NodeError('expecting Tuple, got Starred, coerce disabled')
 
src: call((x,))  # src='x,'
FST: call((x,))
AST: call((x,))
 
src: call((*x,))  # src='*x,'
FST: call((*x,))
AST: call((*x,))
 
src: call((x,))  # src='(x,)'
FST: call((x,))
AST: call((x,))
 
src: call([x])  # src='[x]'
FST: NodeError('expecting Tuple, got List, coerce disabled')
AST: NodeError('expecting Tuple, got List, coerce disabled')
 
src: call({x})  # src='{x}'
FST: NodeError('expecting Tuple, got Set, coerce disabled')
AST: NodeError('expecting Tuple, got Set, coerce disabled')
 
src: call({x: y})  # src='{x: y}'
FST: NodeError('expecting Tuple, got Dict, coerce disabled')
AST: NodeError('expecting Tuple, got Dict, coerce disabled')

