Interaction of `one` with `coerce` for slice puts, complicated but needs to feel be common-sense.

>>> import sys
>>> from fst import *

>>> _FILE_CACHE = {}  # {'fnm': list[str], ...}

>>> def version_ok_else_print(version: int, start_marker: str, stop_marker: str) -> bool:
...     """If python version high enough then do nothing, otherwise print what would have been printed."""
...
...     if sys.version_info[1] >= version:
...         return True
...
...     if (lines := _FILE_CACHE.get(__file__)) is None:
...         with open(__file__) as fp:
...             lines = _FILE_CACHE[__file__] = fp.readlines()
...
...     start_marker += '\n'
...     stop_marker += '\n'
...     itr = iter(enumerate(lines))
...
...     for start, line in itr:
...         if line.endswith(start_marker):
...             break
...     else:
...         raise RuntimeError(f'start marker {start_marker[:-1]} not found')
...
...     for stop, line in itr:
...         if line.endswith(stop_marker):
...             break
...     else:
...         raise RuntimeError(f'stop marker {stop_marker[:-1]} not found')
...
...     print(''.join(lines[start + 1 : stop])[:-1], end='')
...
...     return False

>>> def test_one_coerce_target_src(one: bool, coerce: bool, target: str, field: str, src: str, mode=None):
...     for name, code in [
...         ('src', src),
...         ('FST', FST(src, mode)),
...         ('AST', FST(src, mode).a),
...     ]:
...         try:
...             text = f"{name}: {FST(target).put_slice(code, field, one=one, coerce=coerce).verify().src}"
...         except Exception as exc:
...             text = f'{name}: {exc!r}'
...
...         print(text if name != 'src' else f'{text}  # {src=}')
...
...     print('\xa0')

>>> def test_target_srcs(target: str, field: str, srcs: list[str], mode=None):
...     for one, coerce in ((False, True), (False, False), (True, True), (True, False)):
...         print('\xa0')
...         print(text := f'{one=}, {coerce=}')
...         print('-' * len(text))
...         print('\xa0')
...
...         for src in srcs:
...             test_one_coerce_target_src(one, coerce, target, field, src, mode)




========================================================================================================================
_arglikes
========================================================================================================================

........................................................................................................................
>>> test_target_srcs('call(a, b, c)', '_args', ['x', '*x', 'x,', '*x,', '(x,)', '[x]', '{x}', '{x: y}',])
 
one=False, coerce=True
----------------------
 
src: call(x)  # src='x'
FST: call(x)
AST: call(x)
 
src: call(*x)  # src='*x'
FST: call(*x)
AST: call(*x)
 
src: call(x)  # src='x,'
FST: call(x)
AST: call(x)
 
src: call(*x)  # src='*x,'
FST: call(*x)
AST: call(*x)
 
src: call((x,))  # src='(x,)'
FST: call(x)
AST: call(x)
 
src: call([x])  # src='[x]'
FST: call(x)
AST: call(x)
 
src: call({x})  # src='{x}'
FST: call(x)
AST: call(x)
 
src: call({x: y})  # src='{x: y}'
FST: call({x: y})
AST: call({x: y})
 
 
one=False, coerce=False
-----------------------
 
src: call(x)  # src='x'
FST: NodeError('expecting _arglikes, got Name, coerce disabled')
AST: NodeError('expecting _arglikes, got Name, coerce disabled')
 
src: call(*x)  # src='*x'
FST: NodeError('expecting _arglikes, got Starred, coerce disabled')
AST: NodeError('expecting _arglikes, got Starred, coerce disabled')
 
src: call(x)  # src='x,'
FST: NodeError('expecting _arglikes, got Tuple, coerce disabled')
AST: NodeError('expecting _arglikes, got Tuple, coerce disabled')
 
src: call(*x)  # src='*x,'
FST: NodeError('expecting _arglikes, got Tuple, coerce disabled')
AST: NodeError('expecting _arglikes, got Tuple, coerce disabled')
 
src: call((x,))  # src='(x,)'
FST: NodeError('expecting _arglikes, got Tuple, coerce disabled')
AST: NodeError('expecting _arglikes, got Tuple, coerce disabled')
 
src: call([x])  # src='[x]'
FST: NodeError('expecting _arglikes, got List, coerce disabled')
AST: NodeError('expecting _arglikes, got List, coerce disabled')
 
src: call({x})  # src='{x}'
FST: NodeError('expecting _arglikes, got Set, coerce disabled')
AST: NodeError('expecting _arglikes, got Set, coerce disabled')
 
src: call({x: y})  # src='{x: y}'
FST: NodeError('expecting _arglikes, got Dict, coerce disabled')
AST: NodeError('expecting _arglikes, got Dict, coerce disabled')
 
 
one=True, coerce=True
---------------------
 
src: call(x)  # src='x'
FST: call(x)
AST: call(x)
 
src: call(*x)  # src='*x'
FST: call(*x)
AST: call(*x)
 
src: call((x,))  # src='x,'
FST: call((x,))
AST: call((x,))
 
src: call((*x,))  # src='*x,'
FST: call((*x,))
AST: call((*x,))
 
src: call((x,))  # src='(x,)'
FST: call((x,))
AST: call((x,))
 
src: call([x])  # src='[x]'
FST: call([x])
AST: call([x])
 
src: call({x})  # src='{x}'
FST: call({x})
AST: call({x})
 
src: call({x: y})  # src='{x: y}'
FST: call({x: y})
AST: call({x: y})
 
 
one=True, coerce=False
----------------------
 
src: call(x)  # src='x'
FST: NodeError('expecting _arglikes, got Name, coerce disabled')
AST: NodeError('expecting _arglikes, got Name, coerce disabled')
 
src: call(*x)  # src='*x'
FST: NodeError('expecting _arglikes, got Starred, coerce disabled')
AST: NodeError('expecting _arglikes, got Starred, coerce disabled')
 
src: call((x,))  # src='x,'
FST: NodeError('expecting _arglikes, got Tuple, coerce disabled')
AST: NodeError('expecting _arglikes, got Tuple, coerce disabled')
 
src: call((*x,))  # src='*x,'
FST: NodeError('expecting _arglikes, got Tuple, coerce disabled')
AST: NodeError('expecting _arglikes, got Tuple, coerce disabled')
 
src: call((x,))  # src='(x,)'
FST: NodeError('expecting _arglikes, got Tuple, coerce disabled')
AST: NodeError('expecting _arglikes, got Tuple, coerce disabled')
 
src: call([x])  # src='[x]'
FST: NodeError('expecting _arglikes, got List, coerce disabled')
AST: NodeError('expecting _arglikes, got List, coerce disabled')
 
src: call({x})  # src='{x}'
FST: NodeError('expecting _arglikes, got Set, coerce disabled')
AST: NodeError('expecting _arglikes, got Set, coerce disabled')
 
src: call({x: y})  # src='{x: y}'
FST: NodeError('expecting _arglikes, got Dict, coerce disabled')
AST: NodeError('expecting _arglikes, got Dict, coerce disabled')
 

........................................................................................................................
>>> test_target_srcs('call(a, b, c)', '_args', ['x', '*x', 'k=w', '**kw'], '_arglikes')
 
one=False, coerce=True
----------------------
 
src: call(x)  # src='x'
FST: call(x)
AST: call(x)
 
src: call(*x)  # src='*x'
FST: call(*x)
AST: call(*x)
 
src: call(k=w)  # src='k=w'
FST: call(k=w)
AST: call(k=w)
 
src: call(**kw)  # src='**kw'
FST: call(**kw)
AST: call(**kw)
 
 
one=False, coerce=False
-----------------------
 
src: call(x)  # src='x'
FST: call(x)
AST: call(x)
 
src: call(*x)  # src='*x'
FST: call(*x)
AST: call(*x)
 
src: call(k=w)  # src='k=w'
FST: call(k=w)
AST: call(k=w)
 
src: call(**kw)  # src='**kw'
FST: call(**kw)
AST: call(**kw)
 
 
one=True, coerce=True
---------------------
 
src: call(x)  # src='x'
FST: call((x,))
AST: call((x,))
 
src: call(*x)  # src='*x'
FST: call((*x,))
AST: call((*x,))
 
src: call(k=w)  # src='k=w'
FST: NodeError('keyword cannot be put into a Tuple for put as `one=True`')
AST: NodeError('keyword cannot be put into a Tuple for put as `one=True`')
 
src: call(**kw)  # src='**kw'
FST: NodeError('keyword cannot be put into a Tuple for put as `one=True`')
AST: NodeError('keyword cannot be put into a Tuple for put as `one=True`')
 
 
one=True, coerce=False
----------------------
 
src: call(x)  # src='x'
FST: call((x,))
AST: call((x,))
 
src: call(*x)  # src='*x'
FST: call((*x,))
AST: call((*x,))
 
src: call(k=w)  # src='k=w'
FST: NodeError('keyword cannot be put into a Tuple for put as `one=True`')
AST: NodeError('keyword cannot be put into a Tuple for put as `one=True`')
 
src: call(**kw)  # src='**kw'
FST: NodeError('keyword cannot be put into a Tuple for put as `one=True`')
AST: NodeError('keyword cannot be put into a Tuple for put as `one=True`')
 

........................................................................................................................
>>> test_target_srcs('call(a, b, c)', '_args', ['k=w', '**kw'], 'keyword')
 
one=False, coerce=True
----------------------
 
src: call(k=w)  # src='k=w'
FST: call(k=w)
AST: call(k=w)
 
src: call(**kw)  # src='**kw'
FST: call(**kw)
AST: call(**kw)
 
 
one=False, coerce=False
-----------------------
 
src: call(k=w)  # src='k=w'
FST: NodeError('expecting _arglikes, got keyword, coerce disabled')
AST: NodeError('expecting _arglikes, got keyword, coerce disabled')
 
src: call(**kw)  # src='**kw'
FST: NodeError('expecting _arglikes, got keyword, coerce disabled')
AST: NodeError('expecting _arglikes, got keyword, coerce disabled')
 
 
one=True, coerce=True
---------------------
 
src: call(k=w)  # src='k=w'
FST: call(k=w)
AST: call(k=w)
 
src: call(**kw)  # src='**kw'
FST: call(**kw)
AST: call(**kw)
 
 
one=True, coerce=False
----------------------
 
src: call(k=w)  # src='k=w'
FST: NodeError('expecting _arglikes, got keyword, coerce disabled')
AST: NodeError('expecting _arglikes, got keyword, coerce disabled')
 
src: call(**kw)  # src='**kw'
FST: NodeError('expecting _arglikes, got keyword, coerce disabled')
AST: NodeError('expecting _arglikes, got keyword, coerce disabled')
 



========================================================================================================================
_type_params
========================================================================================================================

........................................................................................................................
>>> if version_ok_else_print(12, 'TYPE_PARAMS_1_START', 'TYPE_PARAMS_1_STOP'):
...     test_target_srcs('type t[a, b, c] = ...', 'type_params', ['x', '*x', 'x,', '*x,', '(x,)', '[x]', '{x}', '{x: y}',])  # TYPE_PARAMS_1_START
 
one=False, coerce=True
----------------------
 
src: type t[x] = ...  # src='x'
FST: type t[x] = ...
AST: type t[x] = ...
 
src: type t[*x] = ...  # src='*x'
FST: type t[*x] = ...
AST: type t[*x] = ...
 
src: type t[x] = ...  # src='x,'
FST: type t[x] = ...
AST: type t[x] = ...
 
src: type t[*x] = ...  # src='*x,'
FST: type t[*x] = ...
AST: type t[*x] = ...
 
src: SyntaxError('invalid syntax', ('<fst>', 2, 1, '(x,)', 2, 2))  # src='(x,)'
FST: type t[x] = ...
AST: type t[x] = ...
 
src: SyntaxError('invalid syntax', ('<fst>', 2, 1, '[x]', 2, 2))  # src='[x]'
FST: type t[x] = ...
AST: type t[x] = ...
 
src: SyntaxError('invalid syntax', ('<fst>', 2, 1, '{x}', 2, 2))  # src='{x}'
FST: type t[x] = ...
AST: type t[x] = ...
 
src: SyntaxError('invalid syntax', ('<fst>', 2, 1, '{x: y}', 2, 2))  # src='{x: y}'
FST: NodeError('expecting _type_params, got Dict, could not coerce')
AST: NodeError('expecting _type_params, got Dict, could not coerce')
 
 
one=False, coerce=False
-----------------------
 
src: type t[x] = ...  # src='x'
FST: NodeError('expecting _type_params, got Name, coerce disabled')
AST: NodeError('expecting _type_params, got Name, coerce disabled')
 
src: type t[*x] = ...  # src='*x'
FST: NodeError('expecting _type_params, got Starred, coerce disabled')
AST: NodeError('expecting _type_params, got Starred, coerce disabled')
 
src: type t[x] = ...  # src='x,'
FST: NodeError('expecting _type_params, got Tuple, coerce disabled')
AST: NodeError('expecting _type_params, got Tuple, coerce disabled')
 
src: type t[*x] = ...  # src='*x,'
FST: NodeError('expecting _type_params, got Tuple, coerce disabled')
AST: NodeError('expecting _type_params, got Tuple, coerce disabled')
 
src: SyntaxError('invalid syntax', ('<fst>', 2, 1, '(x,)', 2, 2))  # src='(x,)'
FST: NodeError('expecting _type_params, got Tuple, coerce disabled')
AST: NodeError('expecting _type_params, got Tuple, coerce disabled')
 
src: SyntaxError('invalid syntax', ('<fst>', 2, 1, '[x]', 2, 2))  # src='[x]'
FST: NodeError('expecting _type_params, got List, coerce disabled')
AST: NodeError('expecting _type_params, got List, coerce disabled')
 
src: SyntaxError('invalid syntax', ('<fst>', 2, 1, '{x}', 2, 2))  # src='{x}'
FST: NodeError('expecting _type_params, got Set, coerce disabled')
AST: NodeError('expecting _type_params, got Set, coerce disabled')
 
src: SyntaxError('invalid syntax', ('<fst>', 2, 1, '{x: y}', 2, 2))  # src='{x: y}'
FST: NodeError('expecting _type_params, got Dict, coerce disabled')
AST: NodeError('expecting _type_params, got Dict, coerce disabled')
 
 
one=True, coerce=True
---------------------
 
src: type t[x] = ...  # src='x'
FST: type t[x] = ...
AST: type t[x] = ...
 
src: type t[*x] = ...  # src='*x'
FST: type t[*x] = ...
AST: type t[*x] = ...
 
src: type t[x] = ...  # src='x,'
FST: type t[x] = ...
AST: type t[x] = ...
 
src: type t[*x] = ...  # src='*x,'
FST: type t[*x] = ...
AST: type t[*x] = ...
 
src: SyntaxError('invalid syntax', ('<fst>', 2, 1, '(x,)', 2, 2))  # src='(x,)'
FST: type t[x] = ...
AST: type t[x] = ...
 
src: SyntaxError('invalid syntax', ('<fst>', 2, 1, '[x]', 2, 2))  # src='[x]'
FST: type t[x] = ...
AST: type t[x] = ...
 
src: SyntaxError('invalid syntax', ('<fst>', 2, 1, '{x}', 2, 2))  # src='{x}'
FST: type t[x] = ...
AST: type t[x] = ...
 
src: SyntaxError('invalid syntax', ('<fst>', 2, 1, '{x: y}', 2, 2))  # src='{x: y}'
FST: NodeError('expecting _type_params, got Dict, could not coerce')
AST: NodeError('expecting _type_params, got Dict, could not coerce')
 
 
one=True, coerce=False
----------------------
 
src: type t[x] = ...  # src='x'
FST: NodeError('expecting _type_params, got Name, coerce disabled')
AST: NodeError('expecting _type_params, got Name, coerce disabled')
 
src: type t[*x] = ...  # src='*x'
FST: NodeError('expecting _type_params, got Starred, coerce disabled')
AST: NodeError('expecting _type_params, got Starred, coerce disabled')
 
src: type t[x] = ...  # src='x,'
FST: NodeError('expecting _type_params, got Tuple, coerce disabled')
AST: NodeError('expecting _type_params, got Tuple, coerce disabled')
 
src: type t[*x] = ...  # src='*x,'
FST: NodeError('expecting _type_params, got Tuple, coerce disabled')
AST: NodeError('expecting _type_params, got Tuple, coerce disabled')
 
src: SyntaxError('invalid syntax', ('<fst>', 2, 1, '(x,)', 2, 2))  # src='(x,)'
FST: NodeError('expecting _type_params, got Tuple, coerce disabled')
AST: NodeError('expecting _type_params, got Tuple, coerce disabled')
 
src: SyntaxError('invalid syntax', ('<fst>', 2, 1, '[x]', 2, 2))  # src='[x]'
FST: NodeError('expecting _type_params, got List, coerce disabled')
AST: NodeError('expecting _type_params, got List, coerce disabled')
 
src: SyntaxError('invalid syntax', ('<fst>', 2, 1, '{x}', 2, 2))  # src='{x}'
FST: NodeError('expecting _type_params, got Set, coerce disabled')
AST: NodeError('expecting _type_params, got Set, coerce disabled')
 
src: SyntaxError('invalid syntax', ('<fst>', 2, 1, '{x: y}', 2, 2))  # src='{x: y}'
FST: NodeError('expecting _type_params, got Dict, coerce disabled')
AST: NodeError('expecting _type_params, got Dict, coerce disabled')
 

# TYPE_PARAMS_1_STOP


........................................................................................................................
>>> if version_ok_else_print(12, 'TYPE_PARAMS_2_START', 'TYPE_PARAMS_2_STOP'):
...     test_target_srcs('type t[a, b, c] = ...', 'type_params', ['T', '*U', '**V'], 'type_param')  # TYPE_PARAMS_2_START
 
one=False, coerce=True
----------------------
 
src: type t[T] = ...  # src='T'
FST: type t[T] = ...
AST: type t[T] = ...
 
src: type t[*U] = ...  # src='*U'
FST: type t[*U] = ...
AST: type t[*U] = ...
 
src: type t[**V] = ...  # src='**V'
FST: type t[**V] = ...
AST: type t[**V] = ...
 
 
one=False, coerce=False
-----------------------
 
src: type t[T] = ...  # src='T'
FST: NodeError('expecting _type_params, got TypeVar, coerce disabled')
AST: NodeError('expecting _type_params, got TypeVar, coerce disabled')
 
src: type t[*U] = ...  # src='*U'
FST: NodeError('expecting _type_params, got TypeVarTuple, coerce disabled')
AST: NodeError('expecting _type_params, got TypeVarTuple, coerce disabled')
 
src: type t[**V] = ...  # src='**V'
FST: NodeError('expecting _type_params, got ParamSpec, coerce disabled')
AST: NodeError('expecting _type_params, got ParamSpec, coerce disabled')
 
 
one=True, coerce=True
---------------------
 
src: type t[T] = ...  # src='T'
FST: type t[T] = ...
AST: type t[T] = ...
 
src: type t[*U] = ...  # src='*U'
FST: type t[*U] = ...
AST: type t[*U] = ...
 
src: type t[**V] = ...  # src='**V'
FST: type t[**V] = ...
AST: type t[**V] = ...
 
 
one=True, coerce=False
----------------------
 
src: type t[T] = ...  # src='T'
FST: NodeError('expecting _type_params, got TypeVar, coerce disabled')
AST: NodeError('expecting _type_params, got TypeVar, coerce disabled')
 
src: type t[*U] = ...  # src='*U'
FST: NodeError('expecting _type_params, got TypeVarTuple, coerce disabled')
AST: NodeError('expecting _type_params, got TypeVarTuple, coerce disabled')
 
src: type t[**V] = ...  # src='**V'
FST: NodeError('expecting _type_params, got ParamSpec, coerce disabled')
AST: NodeError('expecting _type_params, got ParamSpec, coerce disabled')
 

# TYPE_PARAMS_2_STOP


========================================================================================================================
_expr_arglikes
========================================================================================================================

>>> test_target_srcs('call(a, b, c)', 'args', ['x', '*x', 'x,', '*x,', '(x,)', '[x]', '{x}', '{x: y}'])
 
one=False, coerce=True
----------------------
 
src: call(x)  # src='x'
FST: call(x)
AST: call(x)
 
src: call(*x)  # src='*x'
FST: call(*x)
AST: call(*x)
 
src: call(x)  # src='x,'
FST: call(x)
AST: call(x)
 
src: call(*x)  # src='*x,'
FST: call(*x)
AST: call(*x)
 
src: call((x,))  # src='(x,)'
FST: call(x)
AST: call(x)
 
src: call([x])  # src='[x]'
FST: call(x)
AST: call(x)
 
src: call({x})  # src='{x}'
FST: call(x)
AST: call(x)
 
src: call({x: y})  # src='{x: y}'
FST: call({x: y})
AST: call({x: y})
 
 
one=False, coerce=False
-----------------------
 
src: call(x)  # src='x'
FST: NodeError('expecting Tuple, got Name, coerce disabled')
AST: NodeError('expecting Tuple, got Name, coerce disabled')
 
src: call(*x)  # src='*x'
FST: NodeError('expecting Tuple, got Starred, coerce disabled')
AST: NodeError('expecting Tuple, got Starred, coerce disabled')
 
src: call(x)  # src='x,'
FST: call(x)
AST: call(x)
 
src: call(*x)  # src='*x,'
FST: call(*x)
AST: call(*x)
 
src: call((x,))  # src='(x,)'
FST: call(x)
AST: call(x)
 
src: call([x])  # src='[x]'
FST: NodeError('expecting Tuple, got List, coerce disabled')
AST: NodeError('expecting Tuple, got List, coerce disabled')
 
src: call({x})  # src='{x}'
FST: NodeError('expecting Tuple, got Set, coerce disabled')
AST: NodeError('expecting Tuple, got Set, coerce disabled')
 
src: call({x: y})  # src='{x: y}'
FST: NodeError('expecting Tuple, got Dict, coerce disabled')
AST: NodeError('expecting Tuple, got Dict, coerce disabled')
 
 
one=True, coerce=True
---------------------
 
src: call(x)  # src='x'
FST: call(x)
AST: call(x)
 
src: call(*x)  # src='*x'
FST: call(*x)
AST: call(*x)
 
src: call((x,))  # src='x,'
FST: call((x,))
AST: call((x,))
 
src: call((*x,))  # src='*x,'
FST: call((*x,))
AST: call((*x,))
 
src: call((x,))  # src='(x,)'
FST: call((x,))
AST: call((x,))
 
src: call([x])  # src='[x]'
FST: call([x])
AST: call([x])
 
src: call({x})  # src='{x}'
FST: call({x})
AST: call({x})
 
src: call({x: y})  # src='{x: y}'
FST: call({x: y})
AST: call({x: y})
 
 
one=True, coerce=False
----------------------
 
src: call(x)  # src='x'
FST: NodeError('expecting Tuple, got Name, coerce disabled')
AST: NodeError('expecting Tuple, got Name, coerce disabled')
 
src: call(*x)  # src='*x'
FST: NodeError('expecting Tuple, got Starred, coerce disabled')
AST: NodeError('expecting Tuple, got Starred, coerce disabled')
 
src: call((x,))  # src='x,'
FST: call((x,))
AST: call((x,))
 
src: call((*x,))  # src='*x,'
FST: call((*x,))
AST: call((*x,))
 
src: call((x,))  # src='(x,)'
FST: call((x,))
AST: call((x,))
 
src: call([x])  # src='[x]'
FST: NodeError('expecting Tuple, got List, coerce disabled')
AST: NodeError('expecting Tuple, got List, coerce disabled')
 
src: call({x})  # src='{x}'
FST: NodeError('expecting Tuple, got Set, coerce disabled')
AST: NodeError('expecting Tuple, got Set, coerce disabled')
 
src: call({x: y})  # src='{x: y}'
FST: NodeError('expecting Tuple, got Dict, coerce disabled')
AST: NodeError('expecting Tuple, got Dict, coerce disabled')
 
