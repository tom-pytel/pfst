Miscellaneous console sessions mostly meant to screen for random errors. Feel free to nuke any of these should they
become annoying.

>>> from fst import *


........................................................................................................................
>>> f = FST('''
... class cls:
...     def __init__(self):
...         pass
...
...     def meth(self, a):
...         return a
... ''')
>>> f
<ClassDef ROOT 1,0..6,16>
>>> f.src
'\nclass cls:\n    def __init__(self):\n        pass\n\n    def meth(self, a):\n        return a\n'
>>> print(_)
<BLANKLINE>
class cls:
    def __init__(self):
        pass
<BLANKLINE>
    def meth(self, a):
        return a
<BLANKLINE>
>>> f.body[1]
<FunctionDef 5,4..6,16>
>>> _.src
'def meth(self, a):\n        return a'
>>> print(f.body[1].src)
def meth(self, a):
        return a
>>> print(f.body[1].copy().src)
def meth(self, a):
    return a
>>> f.body.append(f.body[1].copy())
<<ClassDef ROOT 1,0..9,16>.body [<FunctionDef 2,4..3,12>, <FunctionDef 5,4..6,16>, <FunctionDef 8,4..9,16>]>
>>> print(f.src)
<BLANKLINE>
class cls:
    def __init__(self):
        pass
<BLANKLINE>
    def meth(self, a):
        return a
<BLANKLINE>
    def meth(self, a):
        return a
>>> f.body[-1]
<FunctionDef 8,4..9,16>
>>> f.body[-1].name = 'blahblahblah'
>>> print(f.src)
<BLANKLINE>
class cls:
    def __init__(self):
        pass
<BLANKLINE>
    def meth(self, a):
        return a
<BLANKLINE>
    def blahblahblah(self, a):
        return a


........................................................................................................................
>>> f = FST('{a: b}')
>>> f.keys[0]
<Name 0,1..0,2>

>>> f.keys[0] = 'x := y'
>>> f.src
'{(x := y): b}'

>>> f.keys[0] = None
>>> f.src
'{**b}'


........................................................................................................................
>>> f = FST('class a: pass')
>>> f.bases = 'base,'
>>> g = FST('del a')
>>> g.targets = 'b'
>>> g.src
'del b'
>>> g.targets = 'c,'
>>> g.src
'del c'
>>> FST('del z,')
<Delete ROOT 0,0..0,6>
>>> __ = _.dump()
Delete - ROOT 0,0..0,6
  .targets[1]
   0] Name 'z' Del - 0,4..0,5
>>> f.src
'class a(base): pass'
>>> g.src
'del c'
>>> __ = g.dump()
Delete - ROOT 0,0..0,5
  .targets[1]
   0] Name 'c' Del - 0,4..0,5
>>> __ = FST('del z,').dump()
Delete - ROOT 0,0..0,6
  .targets[1]
   0] Name 'z' Del - 0,4..0,5
>>> __ = FST('del z,', 'stmt').dump()
Delete - ROOT 0,0..0,6
  .targets[1]
   0] Name 'z' Del - 0,4..0,5
>>> h = FST('del z,')
>>> h.targets = 'x'
>>> h.src
'del x'
>>> h.targets = 'x,'
>>> h.src
'del x'
>>> h = FST('del z,')
>>> h.targets[0] = 'a, b'
>>> h.src
'del (a, b),'
>>> h.verify()
<Delete ROOT 0,0..0,11>
>>> __ = h.dump('s')
0: del (a, b),
Delete - ROOT 0,0..0,11
  .targets[1]
   0] Tuple - 0,4..0,10
     .elts[2]
      0] Name 'a' Del - 0,5..0,6
      1] Name 'b' Del - 0,8..0,9
     .ctx Del
>>> FST('class cls(b,): pass')
<ClassDef ROOT 0,0..0,19>
>>> f = _
>>> __ = f.dump()
ClassDef - ROOT 0,0..0,19
  .name 'cls'
  .bases[1]
   0] Name 'b' Load - 0,10..0,11
  .body[1]
   0] Pass - 0,15..0,19
>>> f.src
'class cls(b,): pass'
>>> f.bases = 'z,'
>>> f.src
'class cls(z): pass'
>>> __ = f.dump()
ClassDef - ROOT 0,0..0,18
  .name 'cls'
  .bases[1]
   0] Name 'z' Load - 0,10..0,11
  .body[1]
   0] Pass - 0,14..0,18


........................................................................................................................
>>> f = FST('call(*not a, *[] or ())')
>>> g = f.get_slice('args', pars_arglike=False)
>>> g.src
'(*not a, *[] or ())'
>>> __ = g.dump()
Tuple - ROOT 0,0..0,19
  .elts[2]
   0] Starred - 0,1..0,7
     .value UnaryOp - 0,2..0,7
       .op Not - 0,2..0,5
       .operand Name 'a' Load - 0,6..0,7
     .ctx Load
   1] Starred - 0,9..0,18
     .value BoolOp - 0,10..0,18
       .op Or
       .values[2]
        0] List - 0,10..0,12
          .ctx Load
        1] Tuple - 0,16..0,18
          .ctx Load
     .ctx Load
  .ctx Load
>>> f.args = None
>>> f.src
'call()'
>>> f.args = g.copy()
>>> f.src
'call(*not a, *[] or ())'


........................................................................................................................
insert into empty BoolOp slice

>>> f = FST('a and b')
>>> f.put_slice(None)
<BoolOp ROOT 0,0..0,0>
>>> __ = f.dump()
BoolOp - ROOT 0,0..0,0
  .op And
>>> f.put_slice('x')
<BoolOp ROOT 0,0..0,1>
>>> __ = f.dump('N')
0: x
BoolOp - ROOT 0,0..0,1
  .op And
  .values[1]
0: x
   0] Name 'x' Load - 0,0..0,1
>>> f.put_slice('y')
<BoolOp ROOT 0,0..0,1>
>>> __ = f.dump('N')
0: y
BoolOp - ROOT 0,0..0,1
  .op And
  .values[1]
0: y
   0] Name 'y' Load - 0,0..0,1
>>> f.put_slice('z', 1, 1)
<BoolOp ROOT 0,0..0,7>
>>> __ = f.dump('N')
0: y and z
BoolOp - ROOT 0,0..0,7
  .op And
  .values[2]
0: y
   0] Name 'y' Load - 0,0..0,1
0:       z
   1] Name 'z' Load - 0,6..0,7


........................................................................................................................
replace() end of sequence with nothing

>>> f = FST('a\nb\nc\nd\ne')
>>> f.body[1].replace(None)
>>> f.body[1].replace('')
Traceback (most recent call last):
  File "<python-input-4>", line 1, in <module>
    f.body[1].replace('')
    ~~~~~~~~~~~~~~~~~^^^^
  File "/home/tom/work/fst/pfst/src/fst/fst.py", line 1576, in replace
    return parent._put_one(code, idx, field, options)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/tom/work/fst/pfst/src/fst/fst_put_one.py", line 2793, in _put_one
    new_self = self._put_slice(code, idx, idx + 1, field, True, options)  # MAYBE new self, or just old self
  File "/home/tom/work/fst/pfst/src/fst/fst_put_slice.py", line 2881, in _put_slice
    handler(self, code, start, stop, field, one, options)
    ~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/tom/work/fst/pfst/src/fst/slice_stmtlike.py", line 1462, in put_slice_stmtlike
    put_fst_end_nl = _put_slice_stmtlike_old(self, code, start, stop, field, one, options)
  File "/home/tom/work/fst/pfst/src/fst/slice_stmtlike.py", line 1128, in _put_slice_stmtlike_old
    raise ValueError('expecting a single element')
ValueError: expecting a single element
>>> f.body[1].replace('', one=False)
<Expr 1,0..1,1>
>>> _.src
'd'
>>> f.src
'a\nd\ne'
>>> f.body[1].replace('x\ny\nz', one=False)
<Expr 1,0..1,1>
>>> _.src
'x'
>>> f.body[-1].replace('u', one=False)
<Expr 4,0..4,1>
>>> _.src
'u'
>>> f.src
'a\nx\ny\nz\nu'
>>> f.put('', -1, one=False)
Traceback (most recent call last):
  File "<python-input-14>", line 1, in <module>
    f.put('', -1, one=False)
    ~~~~~^^^^^^^^^^^^^^^^^^^
  File "/home/tom/work/fst/pfst/src/fst/fst.py", line 1828, in put
    raise ValueError("cannot use 'one=False' in non-slice put()")
ValueError: cannot use 'one=False' in non-slice put()
>>> f.body[-1].replace('', one=False)
>>> f.src
'a\nx\ny\nz\n'


........................................................................................................................
>>> from pprint import pp
>>> from fst import *
>>> from fst import code as cd, parsex as px

>>> FST('with a: pass').put_slice(FST('([x])'), 'items', one=True).dump('N').verify()
0: with ([x]):
With - ROOT 0,0..0,16
  .items[1]
0:      ([x])
   0] withitem - 0,5..0,10
0:       [x]
     .context_expr List - 0,6..0,9
       .elts[1]
0:        x
        0] Name 'x' Load - 0,7..0,8
       .ctx Load
  .body[1]
0:             pass
   0] Pass - 0,12..0,16
<With ROOT 0,0..0,16>

>>> cd.code_as_withitem('(x,)', coerce=True).dump('N').verify()
0: (x,)
withitem - ROOT 0,0..0,4
0: (x,)
  .context_expr Tuple - 0,0..0,4
    .elts[1]
0:  x
     0] Name 'x' Load - 0,1..0,2
    .ctx Load
<withitem ROOT 0,0..0,4>

>>> cd.code_as_withitem('x,', coerce=True).dump('N').verify()
Traceback (most recent call last):
...
fst.ParseError: expecting single withitem, has trailing comma

>>> cd.code_as_withitem(FST('x,'), coerce=True).dump('N').verify()
0: (x,)
withitem - ROOT 0,0..0,4
0: (x,)
  .context_expr Tuple - 0,0..0,4
    .elts[1]
0:  x
     0] Name 'x' Load - 0,1..0,2
    .ctx Load
<withitem ROOT 0,0..0,4>

>>> cd.code_as_withitem(FST('x,').a, coerce=True).dump('N').verify()
0: (x,)
withitem - ROOT 0,0..0,4
0: (x,)
  .context_expr Tuple - 0,0..0,4
    .elts[1]
0:  x
     0] Name 'x' Load - 0,1..0,2
    .ctx Load
<withitem ROOT 0,0..0,4>

>>> print(dump(px.parse_withitem('(x,)'), include_attributes=2, indent=2))
withitem(
  context_expr=Tuple(
    elts=[
      Name(
        id='x',
        ctx=Load(),
        lineno=1,
        col_offset=1,
        end_lineno=1,
        end_col_offset=2)],
    ctx=Load(),
    lineno=1,
    col_offset=0,
    end_lineno=1,
    end_col_offset=4))

>>> dump(px.parse_withitem('x as y'))
"withitem(context_expr=Name(id='x', ctx=Load()), optional_vars=Name(id='y', ctx=Store()))"

>>> FST('x', withitem).dump('N')
0: x
withitem - ROOT 0,0..0,1
0: x
  .context_expr Name 'x' Load - 0,0..0,1
<withitem ROOT 0,0..0,1>

>>> print(dump(px.parse_withitem('x'), include_attributes=2, indent=2))
withitem(
  context_expr=Name(
    id='x',
    ctx=Load(),
    lineno=1,
    col_offset=0,
    end_lineno=1,
    end_col_offset=1))

>>> FST('with a: pass').put_slice(FST('x,'), 'items', one=True).dump('N').verify()
0: with ((x,)):
With - ROOT 0,0..0,17
  .items[1]
0:      ((x,))
   0] withitem - 0,5..0,11
0:       (x,)
     .context_expr Tuple - 0,6..0,10
       .elts[1]
0:        x
        0] Name 'x' Load - 0,7..0,8
       .ctx Load
  .body[1]
0:              pass
   0] Pass - 0,13..0,17
<With ROOT 0,0..0,17>

>>> FST('with a: pass').put_slice(FST('x, y'), 'items', one=True).dump('N').verify()
0: with ((x, y)):
With - ROOT 0,0..0,19
  .items[1]
0:      ((x, y))
   0] withitem - 0,5..0,13
0:       (x, y)
     .context_expr Tuple - 0,6..0,12
       .elts[2]
0:        x
        0] Name 'x' Load - 0,7..0,8
0:           y
        1] Name 'y' Load - 0,10..0,11
       .ctx Load
  .body[1]
0:                pass
   0] Pass - 0,15..0,19
<With ROOT 0,0..0,19>

>>> FST('with a: pass').put_slice(FST('*a,', 'withitem'), 'items').dump('N').verify()
Traceback (most recent call last):
...
SyntaxError: invalid syntax

>>> FST('w,', '_withitems').dump('N').items[0]._trail_sep()
0: w,
_withitems - ROOT 0,0..0,2
  .items[1]
0: w
   0] withitem - 0,0..0,1
0: w
     .context_expr Name 'w' Load - 0,0..0,1
(0, 1)

>>> print(dump(px.parse_withitem('(x,)'), indent=2))
withitem(
  context_expr=Tuple(
    elts=[
      Name(id='x', ctx=Load())],
    ctx=Load()))

>>> # cd.code_as_withitem(FST('*a'), coerce=True).dump('N').verify()

>>> # cd.code_as__withitems(FST('*a'), coerce=True).dump('N').verify()

>>> # cd.code_as__withitems(FST('*a,'), coerce=True).dump('N').verify()

>>> # px.parse__withitems('*a,')

>>> cd.code_as__withitems('x,').dump('N').verify()
0: x,
_withitems - ROOT 0,0..0,2
  .items[1]
0: x
   0] withitem - 0,0..0,1
0: x
     .context_expr Name 'x' Load - 0,0..0,1
<_withitems ROOT 0,0..0,2>

>>> # cd.code_as__withitems('*x,').dump('N').verify()

>>> cd.code_as__withitems('(*x,)').dump('N').verify()
0: (*x,)
_withitems - ROOT 0,0..0,5
  .items[1]
0: (*x,)
   0] withitem - 0,0..0,5
0: (*x,)
     .context_expr Tuple - 0,0..0,5
       .elts[1]
0:  *x
        0] Starred - 0,1..0,3
0:   x
          .value Name 'x' Load - 0,2..0,3
          .ctx Load
       .ctx Load
<_withitems ROOT 0,0..0,5>

>>> # cd.code_as__comprehension_ifs('*a', coerce=True).dump('N').verify()

>>> # cd.code_as_withitem('*x', coerce=True).dump('N').verify()

>>> FST('call(a)').put_slice(FST('@x\n@y'), 'args', coerce=True).dump('N').verify()
0: call(x,
1:      y)
Call - ROOT 0,0..1,7
0: call
  .func Name 'call' Load - 0,0..0,4
  .args[2]
0:      x
   0] Name 'x' Load - 0,5..0,6
1:      y
   1] Name 'y' Load - 1,5..1,6
<Call ROOT 0,0..1,7>

>>> FST('call(a, b, c)').put_slice(FST('@x\n@y')).src
'call(x,\n     y)'

>>> FST('return').value = '*a'

>>> FST('a = b =').put_slice(FST('d ='), one=True).dump('N')
0: d =
_Assign_targets - ROOT 0,0..0,3
  .targets[1]
0: d
   0] Name 'd' Store - 0,0..0,1
<_Assign_targets ROOT 0,0..0,3>

>>> FST('x', withitem).dump('N')
0: x
withitem - ROOT 0,0..0,1
0: x
  .context_expr Name 'x' Load - 0,0..0,1
<withitem ROOT 0,0..0,1>

>>> FST('with a: pass').put_slice(FST('x', withitem), 'items', one=True).dump('N')
0: with x:
With - ROOT 0,0..0,12
  .items[1]
0:      x
   0] withitem - 0,5..0,6
0:      x
     .context_expr Name 'x' Load - 0,5..0,6
  .body[1]
0:         pass
   0] Pass - 0,8..0,12
<With ROOT 0,0..0,12>

>>> print(FST('\\\n 1,\n2,').put_slice(None, 0, 1).root.src)
\
 2,

>>> FST('a, b, c').put_slice(FST('x, y, z', pattern), 1, 2, coerce=True).dump('N').verify()
0: a, x, y, z, c
Tuple - ROOT 0,0..0,13
  .elts[5]
0: a
   0] Name 'a' Load - 0,0..0,1
0:    x
   1] Name 'x' Load - 0,3..0,4
0:       y
   2] Name 'y' Load - 0,6..0,7
0:          z
   3] Name 'z' Load - 0,9..0,10
0:             c
   4] Name 'c' Load - 0,12..0,13
  .ctx Load
<Tuple ROOT 0,0..0,13>

>>> FST('a, b, c').put_slice(FST('x, y, z', pattern), 1, 2, one=True, coerce=True).dump('N').verify()
0: a, (x, y, z), c
Tuple - ROOT 0,0..0,15
  .elts[3]
0: a
   0] Name 'a' Load - 0,0..0,1
0:    (x, y, z)
   1] Tuple - 0,3..0,12
     .elts[3]
0:     x
      0] Name 'x' Load - 0,4..0,5
0:        y
      1] Name 'y' Load - 0,7..0,8
0:           z
      2] Name 'z' Load - 0,10..0,11
     .ctx Load
0:               c
   2] Name 'c' Load - 0,14..0,15
  .ctx Load
<Tuple ROOT 0,0..0,15>

>>> FST('a, b, c').put_slice(FST('[x, y, z]', pattern), 1, 2, coerce=True).dump('N').verify()
0: a, x, y, z, c
Tuple - ROOT 0,0..0,13
  .elts[5]
0: a
   0] Name 'a' Load - 0,0..0,1
0:    x
   1] Name 'x' Load - 0,3..0,4
0:       y
   2] Name 'y' Load - 0,6..0,7
0:          z
   3] Name 'z' Load - 0,9..0,10
0:             c
   4] Name 'c' Load - 0,12..0,13
  .ctx Load
<Tuple ROOT 0,0..0,13>

>>> FST('a, b, c').put_slice(FST('[x, y, z]', pattern), 1, 2, one=True, coerce=True).dump('N').verify()
0: a, [x, y, z], c
Tuple - ROOT 0,0..0,15
  .elts[3]
0: a
   0] Name 'a' Load - 0,0..0,1
0:    [x, y, z]
   1] List - 0,3..0,12
     .elts[3]
0:     x
      0] Name 'x' Load - 0,4..0,5
0:        y
      1] Name 'y' Load - 0,7..0,8
0:           z
      2] Name 'z' Load - 0,10..0,11
     .ctx Load
0:               c
   2] Name 'c' Load - 0,14..0,15
  .ctx Load
<Tuple ROOT 0,0..0,15>

>>> FST('a, b, c').put_slice(FST('(x, y, z)', pattern), 1, 2, coerce=True).dump('N').verify()
0: a, x, y, z, c
Tuple - ROOT 0,0..0,13
  .elts[5]
0: a
   0] Name 'a' Load - 0,0..0,1
0:    x
   1] Name 'x' Load - 0,3..0,4
0:       y
   2] Name 'y' Load - 0,6..0,7
0:          z
   3] Name 'z' Load - 0,9..0,10
0:             c
   4] Name 'c' Load - 0,12..0,13
  .ctx Load
<Tuple ROOT 0,0..0,13>

>>> FST('a, b, c').put_slice(FST('(x, y, z)', pattern), 1, 2, one=True, coerce=True).dump('N').verify()
0: a, (x, y, z), c
Tuple - ROOT 0,0..0,15
  .elts[3]
0: a
   0] Name 'a' Load - 0,0..0,1
0:    (x, y, z)
   1] Tuple - 0,3..0,12
     .elts[3]
0:     x
      0] Name 'x' Load - 0,4..0,5
0:        y
      1] Name 'y' Load - 0,7..0,8
0:           z
      2] Name 'z' Load - 0,10..0,11
     .ctx Load
0:               c
   2] Name 'c' Load - 0,14..0,15
  .ctx Load
<Tuple ROOT 0,0..0,15>
